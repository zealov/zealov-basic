"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[50],{2371:(t,a,e)=>{e.d(a,{Kz:()=>r,h:()=>o,mJ:()=>n,$Z:()=>l,Vx:()=>s,ob:()=>d});var i=e(4319);function r(t){return(0,i.Z)({url:"/blog/navigation",method:"get",params:t})}function o(t){return(0,i.Z)({url:"/blog/navigation",method:"post",data:t})}function n(t){return(0,i.Z)({url:"/blog/navigation/updateSort",method:"post",data:t})}function l(t){return(0,i.Z)({url:"/blog/navigation/"+t,method:"get"})}function s(t,a){return(0,i.Z)({url:"/blog/navigation/"+t,method:"put",data:a})}function d(t){return(0,i.Z)({url:"/blog/navigation/"+t,method:"delete"})}},9050:(t,a,e)=>{e.r(a),e.d(a,{default:()=>d});var i=e(2371),r=e(113),o=e(1203),n=[],l=0;const s={data:function(){return{expandedKeys:[],draggable:!1,allowDrop:function(t,a,e){return t.level===a.level&&(t.parent.id===a.parent.id?"prev"===e||"next"===e:void 0)},headers:{},action:"",uploadData:{},createNavigationVisible:!1,updateNavigationVisible:!1,navigation_options:[],loading:!1,tableData:[],createLoading:!1,updateLoading:!1,createError:{},updateError:{},imageUrlPreview:"",editImageUrlPreview:"",createNavigationForm:{name:"",url:"",parent_id:[0],image_path:"",description:"",published:!0,sort:0,target:"_blank"},updateNavigationForm:{id:"",name:"",url:"",parent_id:"",image_path:"",description:"",target:"_blank",published:"",sort:""}}},mounted:function(){this.setAction(),this.getNavigation(),this.setHeader()},methods:{setHeader:function(){this.headers={Authorization:"Bearer "+(0,r.LP)()}},setAction:function(){this.action=(0,o.Vy)()+"/blog/file/upload"},updateSort:function(t){var a=this,e=this;new Promise((function(a,i){e.diguiData(t),a()})).then((function(){var t={sortData:n};(0,i.mJ)(t).then((function(t){200==t.code&&a.$message({message:"成功",type:"success"})}))}))},diguiData:function(t){for(var a=0;a<t.length;a++){var e=t[a];n[l]={id:e.id,sort:l},l++,e.children&&this.diguiData(e.children)}},handleRemove:function(t,a){var e=this;"undefined"==a.children||null==a.children?this.$confirm("确定要删除么？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,i.ob)(a.id).then((function(){e.$message({type:"success",message:"删除成功!"}),e.getNavigation()})).catch((function(t){var a=t.response.data;200!==a.code&&e.$message({type:"info",message:a.message})}))})).catch((function(){e.$message({type:"info",message:"取消删除"})})):this.$message({type:"warning",message:"该导航下存在子导航，请先删除子导航"})},updateNavigation:function(){var t=this;this.updateError={},this.updateLoading=!0;var a=this.updateNavigationForm.parent_id;a instanceof Array&&(this.updateNavigationForm.parent_id=a.slice(-1)[0]),(0,i.Vx)(this.updateNavigationForm.id,this.updateNavigationForm).then((function(a){t.$message({message:a.message,type:"success"}),t.updateNavigationVisible=!1,t.getNavigation()})).catch((function(a){var e=a.data;422===a.code&&(t.updateError=e)})).finally((function(){t.updateLoading=!1}))},handleEdit:function(t){var a=this;this.updateError={},(0,i.$Z)(t.id).then((function(t){var e=t.data;a.updateNavigationVisible=!0,a.updateNavigationForm=e;var i;i=a.parentData([],e.parent_id,a.navigation_options),a.updateNavigationForm.parent_id=0==i.length?[0]:i,a.updateLoading=!1,a.editImageUrlPreview=(0,o.UO)()+e.image_path}))},createChildren:function(t){this.createNavigationVisible=!0;var a;a=this.parentData([],t.id,this.navigation_options),this.createNavigationForm.parent_id=0==a.length?[0]:a},parentData:function(t,a,e){var i=this;return e.forEach((function(r){a==r.id?0!=a&&(t.unshift(r.id),i.parentData(t,r.parent_id,e)):r.children instanceof Array&&i.parentData(t,a,r.children)})),t},saveSortData:function(){this.draggable=!1,this.updateSort(this.tableData)},createNavigation:function(t){var a=this;this.createLoading=!0,this.createError={};var e=this.createNavigationForm.parent_id;e instanceof Array&&(this.createNavigationForm.parent_id=e.slice(-1)[0]),(0,i.h)(this.createNavigationForm).then((function(e){a.$message({message:e.message,type:"success"}),a.resetCreateForm(t),a.getNavigation(),a.createNavigationVisible=!1})).catch((function(t){var e=t.data;422===t.code&&(a.createError=e)})).finally((function(){a.createLoading=!1}))},successUpload:function(t,a,e){this.imageUrlPreview=(0,o.UO)()+t.data.path,this.createNavigationForm.image_path=t.data.path},beforeUpload:function(t){this.uploadData.directory="/navigation",this.uploadData.name=t.name},successUploadEdit:function(t,a,e){this.editImageUrlPreview="",this.editImageUrlPreview=(0,o.UO)()+t.data.path,this.updateNavigationForm.image_path=t.data.path},beforeUploadEdit:function(t){this.uploadData.directory="/navigation",this.uploadData.name=t.name},resetCreateForm:function(t){this.$refs[t].resetFields()},getNavigation:function(){var t=this;this.loading=!0;(0,i.Kz)({}).then((function(a){var e=a.data;t.loading=!1,t.tableData=JSON.parse(JSON.stringify(e.navigation)),t.navigation_options=JSON.parse(JSON.stringify(e.navigation)),t.navigation_options.unshift({id:0,name:"顶级导航"})})).catch((function(a){t.loading=!1,t.tableData=[],t.total=0}))},handleDragStart:function(t,a){},handleDragEnter:function(t,a,e){},handleDragLeave:function(t,a,e){},handleDragOver:function(t,a,e){},handleDragEnd:function(t,a,e,i){},handleDrop:function(t,a,e,i){},redirectEdit:function(t){this.$router.push({path:"/admin/blog/navigation_chunk/"+t.id})}}};const d=(0,e(1900).Z)(s,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"content_container"},[e("el-scrollbar",[e("div",{staticClass:"container",staticStyle:{"padding-top":"0"}},[e("div",{staticClass:"header_container is-sticky-top"},[e("div",{staticClass:"left"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){t.createNavigationVisible=!0}}},[e("i",{staticClass:"el-icon-plus"}),t._v(" 创建导航\n                    ")]),t._v(" "),e("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(a){t.draggable=!0}}},[e("i",{staticClass:"el-icon-rank"}),t._v(" 调整排序\n                    ")]),t._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:1==t.draggable,expression:"draggable == true"}],attrs:{size:"small",type:"danger"},on:{click:t.saveSortData}},[t._v("保存排序\n                    ")]),t._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:1==t.draggable,expression:"draggable == true"}],attrs:{size:"small",type:"danger",plain:""},on:{click:function(a){t.draggable=!1}}},[t._v("取消\n                    ")])],1)]),t._v(" "),e("div",{staticClass:"tree-list"},[e("div",{staticClass:"tree-header"},[e("div",{staticClass:"cell title"},[t._v("导航名称")]),t._v(" "),e("div",{staticClass:"cell title"},[t._v("导航地址")]),t._v(" "),e("div",{staticClass:"cell title"},[t._v("状 态")]),t._v(" "),e("div",{staticClass:"cell edit"},[t._v("操作")])]),t._v(" "),e("el-tree",{class:{"is-drag":t.draggable},attrs:{data:t.tableData,"node-key":"id",draggable:t.draggable,"allow-drop":t.allowDrop,"icon-class":"el-icon-arrow-right","default-expand-all":!0,"default-expanded-keys":t.expandedKeys,"expand-on-click-node":!1},on:{"node-drag-start":t.handleDragStart,"node-drag-enter":t.handleDragEnter,"node-drag-leave":t.handleDragLeave,"node-drag-over":t.handleDragOver,"node-drag-end":t.handleDragEnd,"node-drop":t.handleDrop},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.node,r=a.data;return e("span",{staticClass:"custom-tree-node"},[e("span",{staticClass:"cell title",attrs:{title:r.id}},[t._v(t._s(r.name))]),t._v(" "),e("span",{staticClass:"cell title",attrs:{title:r.id}},[t._v(t._s(r.url))]),t._v(" "),e("span",{staticClass:"cell title"},[1==r.published?e("div",[e("el-tag",[t._v("已启用")])],1):0==r.published?e("div",[e("el-tag",{attrs:{type:"danger"}},[t._v("已禁用")])],1):t._e()]),t._v(" "),e("span",{staticClass:"cell edit"},[e("el-button",{attrs:{title:"添加子分类",type:"text"},on:{click:function(a){return t.createChildren(r)}}},[e("i",{staticClass:"el-icon-plus"})]),t._v(" "),e("el-button",{attrs:{type:"text",title:"内容设置"},on:{click:function(a){return t.redirectEdit(r)}}},[e("i",{staticClass:"el-icon-document"})]),t._v(" "),e("el-button",{attrs:{title:"编辑",type:"text"},on:{click:function(a){return t.handleEdit(r)}}},[e("i",{staticClass:"el-icon-edit"})]),t._v(" "),e("el-button",{attrs:{title:"删除",type:"text"},on:{click:function(){return t.handleRemove(i,r)}}},[e("i",{staticClass:"el-icon-delete"})])],1)])}}])})],1)])]),t._v(" "),e("el-dialog",{attrs:{"custom-class":"dialog_tc",title:"创建",visible:t.createNavigationVisible,width:"560px","close-on-click-modal":!1},on:{"update:visible":function(a){t.createNavigationVisible=a}}},[e("el-form",{ref:"createForm",attrs:{model:t.createNavigationForm,"label-width":"80px",size:"medium"}},[e("el-form-item",{attrs:{label:"上级导航",prop:"parent_id",error:t.createError.parent_id?t.createError.parent_id[0]:""}},[e("el-cascader",{attrs:{options:t.navigation_options,clearable:"",filterable:"",props:{checkStrictly:!0,label:"name",value:"id",expandTrigger:"click"},placeholder:"请选择上级导航"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.node,r=a.data;return[e("span",[t._v(t._s(r.name))]),t._v(" "),i.isLeaf?t._e():e("span",[t._v(" ("+t._s(r.children.length)+") ")])]}}]),model:{value:t.createNavigationForm.parent_id,callback:function(a){t.$set(t.createNavigationForm,"parent_id",a)},expression:"createNavigationForm.parent_id"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"name",label:"导航名称",required:"",error:t.createError.name?t.createError.name[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"请输入导航名称"},model:{value:t.createNavigationForm.name,callback:function(a){t.$set(t.createNavigationForm,"name",a)},expression:"createNavigationForm.name"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"url",label:"导航网址",error:t.createError.url?t.createError.url[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"例：www.zealov.com"},model:{value:t.createNavigationForm.url,callback:function(a){t.$set(t.createNavigationForm,"url",a)},expression:"createNavigationForm.url"}})],1),t._v(" "),e("el-form-item",{staticClass:"upload_thumb",attrs:{label:"缩略图",prop:"image_path"}},[e("el-upload",{staticClass:"uploadThumbImg",attrs:{headers:t.headers,action:t.action,"show-file-list":!1,"on-success":t.successUpload,"before-upload":t.beforeUpload,data:t.uploadData}},[t.createNavigationForm.image_path?e("img",{staticClass:"thumb",attrs:{src:t.imageUrlPreview}}):e("i",{staticClass:"el-icon-plus"})]),t._v(" "),e("div",{staticClass:"el-upload__tip"},[t._v("\n                    支持JPG/PNG格式，建议尺寸800*450px或16:9\n                    "),e("br"),t._v("图片大小不超过1MB\n                ")])],1),t._v(" "),e("el-form-item",{attrs:{prop:"description",label:"简介",error:t.createError.description?t.createError.description[0]:""}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入简介",maxlength:"500","show-word-limit":"",rows:3},model:{value:t.createNavigationForm.description,callback:function(a){t.$set(t.createNavigationForm,"description",a)},expression:"createNavigationForm.description"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"published",label:"状态",error:t.createError.published?t.createError.published[0]:""}},[e("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.createNavigationForm.published,callback:function(a){t.$set(t.createNavigationForm,"published",a)},expression:"createNavigationForm.published"}})],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.createNavigationVisible=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{attrs:{type:"primary",loading:t.createLoading},on:{click:function(a){return t.createNavigation("createForm")}}},[t._v("保存")])],1)],1),t._v(" "),e("el-dialog",{attrs:{"custom-class":"dialog_tc",title:"修改",visible:t.updateNavigationVisible,width:"560px","close-on-click-modal":!1},on:{"update:visible":function(a){t.updateNavigationVisible=a}}},[e("el-form",{ref:"updateForm",attrs:{model:t.updateNavigationForm,"label-width":"80px",size:"medium"}},[e("el-form-item",{attrs:{label:"上级导航",prop:"parent_id",error:t.updateError.parent_id?t.updateError.parent_id[0]:""}},[e("el-cascader",{attrs:{options:t.navigation_options,clearable:"",filterable:"",props:{checkStrictly:!0,label:"name",value:"id",expandTrigger:"click"},placeholder:"请输入上级导航"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.node,r=a.data;return[e("span",[t._v(t._s(r.name))]),t._v(" "),i.isLeaf?t._e():e("span",[t._v(" ("+t._s(r.children.length)+") ")])]}}]),model:{value:t.updateNavigationForm.parent_id,callback:function(a){t.$set(t.updateNavigationForm,"parent_id",a)},expression:"updateNavigationForm.parent_id"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"name",label:"导航名称",required:"",error:t.updateError.name?t.updateError.name[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"请输入导航名称"},model:{value:t.updateNavigationForm.name,callback:function(a){t.$set(t.updateNavigationForm,"name",a)},expression:"updateNavigationForm.name"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"url",label:"导航地址",error:t.updateError.url?t.updateError.url[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"请输入导航地址"},model:{value:t.updateNavigationForm.url,callback:function(a){t.$set(t.updateNavigationForm,"url",a)},expression:"updateNavigationForm.url"}})],1),t._v(" "),e("el-form-item",{staticClass:"upload_thumb",attrs:{label:"缩略图",prop:"image_path"}},[e("el-upload",{staticClass:"uploadThumbImg",attrs:{headers:t.headers,action:t.action,"show-file-list":!1,"on-success":t.successUploadEdit,"before-upload":t.beforeUploadEdit,data:t.uploadData}},[t.updateNavigationForm.image_path?e("img",{staticClass:"thumb",attrs:{src:t.editImageUrlPreview}}):e("i",{staticClass:"el-icon-plus"})]),t._v(" "),e("div",{staticClass:"el-upload__tip"},[t._v("\n                    支持JPG/PNG格式，建议尺寸800*450px或16:9\n                    "),e("br"),t._v("图片大小不超过1MB\n                ")])],1),t._v(" "),e("el-form-item",{attrs:{prop:"description",label:"简介",error:t.updateError.description?t.updateError.description[0]:""}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入简介",maxlength:"500","show-word-limit":"",rows:3},model:{value:t.updateNavigationForm.description,callback:function(a){t.$set(t.updateNavigationForm,"description",a)},expression:"updateNavigationForm.description"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"target",label:"打开方式",error:t.updateError.target?t.updateError.target[0]:""}},[e("el-radio",{attrs:{label:"_self"},model:{value:t.updateNavigationForm.target,callback:function(a){t.$set(t.updateNavigationForm,"target",a)},expression:"updateNavigationForm.target"}},[t._v("当前窗口")]),t._v(" "),e("el-radio",{attrs:{label:"_blank"},model:{value:t.updateNavigationForm.target,callback:function(a){t.$set(t.updateNavigationForm,"target",a)},expression:"updateNavigationForm.target"}},[t._v("新建窗口")])],1),t._v(" "),e("el-form-item",{attrs:{prop:"published",label:"状态",error:t.updateError.published?t.updateError.published[0]:""}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.updateNavigationForm.published,callback:function(a){t.$set(t.updateNavigationForm,"published",a)},expression:"updateNavigationForm.published"}})],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.updateNavigationVisible=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{attrs:{type:"primary",loading:t.updateLoading},on:{click:function(a){return t.updateNavigation("updateForm")}}},[t._v("保存")])],1)],1)],1)}),[],!1,null,null,null).exports}}]);