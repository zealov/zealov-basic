"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[681],{681:(a,t,e)=>{e.r(t),e.d(t,{default:()=>d});var i=e(4319);var r=e(113),o=e(1203),n=[],l=0;const s={data:function(){return{expandedKeys:[],draggable:!1,allowDrop:function(a,t,e){return a.level===t.level&&(a.parent.id===t.parent.id?"prev"===e||"next"===e:void 0)},headers:{},action:"",uploadData:{},createNavigationVisible:!1,updateNavigationVisible:!1,navigation_options:[],loading:!1,tableData:[],createLoading:!1,updateLoading:!1,createError:{},updateError:{},imageUrlPreview:"",editImageUrlPreview:"",createNavigationForm:{name:"",url:"",parent_id:[0],image_path:"",description:"",published:!0,sort:0,target:"_blank"},updateNavigationForm:{id:"",name:"",url:"",parent_id:"",image_path:"",description:"",target:"_blank",published:"",sort:""}}},mounted:function(){this.setAction(),this.getNavigation(),this.setHeader()},methods:{setHeader:function(){this.headers={Authorization:"Bearer "+(0,r.LP)()}},setAction:function(){this.action=(0,o.Vy)()+"/blog/file/upload"},updateSort:function(a){var t=this,e=this;new Promise((function(t,i){e.diguiData(a),t()})).then((function(){(function(a){return(0,i.Z)({url:"/blog/navigation/updateSort",method:"post",data:a})})({sortData:n}).then((function(a){200==a.code&&t.$message({message:"成功",type:"success"})}))}))},diguiData:function(a){for(var t=0;t<a.length;t++){var e=a[t];n[l]={id:e.id,sort:l},l++,e.children&&this.diguiData(e.children)}},handleRemove:function(a,t){var e=this;"undefined"==t.children||null==t.children?this.$confirm("确定要删除么？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a;(a=t.id,(0,i.Z)({url:"/blog/navigation/"+a,method:"delete"})).then((function(){e.$message({type:"success",message:"删除成功!"}),e.getNavigation()})).catch((function(a){var t=a.response.data;200!==t.code&&e.$message({type:"info",message:t.message})}))})).catch((function(){e.$message({type:"info",message:"取消删除"})})):this.$message({type:"warning",message:"该导航下存在子导航，请先删除子导航"})},updateNavigation:function(){var a=this;this.updateError={},this.updateLoading=!0;var t,e,r=this.updateNavigationForm.parent_id;r instanceof Array&&(this.updateNavigationForm.parent_id=r.slice(-1)[0]),(t=this.updateNavigationForm.id,e=this.updateNavigationForm,(0,i.Z)({url:"/blog/navigation/"+t,method:"put",data:e})).then((function(t){a.$message({message:t.message,type:"success"}),a.updateNavigationVisible=!1,a.getNavigation()})).catch((function(t){var e=t.data;422===t.code&&(a.updateError=e)})).finally((function(){a.updateLoading=!1}))},handleEdit:function(a){var t,e=this;this.updateError={},(t=a.id,(0,i.Z)({url:"/blog/navigation/"+t,method:"get"})).then((function(a){var t=a.data;e.updateNavigationVisible=!0,e.updateNavigationForm=t;var i;i=e.parentData([],t.parent_id,e.navigation_options),e.updateNavigationForm.parent_id=0==i.length?[0]:i,e.updateLoading=!1,e.editImageUrlPreview=(0,o.UO)()+t.image_path}))},createChildren:function(a){this.createNavigationVisible=!0;var t;t=this.parentData([],a.id,this.navigation_options),this.createNavigationForm.parent_id=0==t.length?[0]:t},parentData:function(a,t,e){var i=this;return e.forEach((function(r){t==r.id?0!=t&&(a.unshift(r.id),i.parentData(a,r.parent_id,e)):r.children instanceof Array&&i.parentData(a,t,r.children)})),a},saveSortData:function(){this.draggable=!1,this.updateSort(this.tableData)},createNavigation:function(a){var t=this;this.createLoading=!0,this.createError={};var e,r=this.createNavigationForm.parent_id;r instanceof Array&&(this.createNavigationForm.parent_id=r.slice(-1)[0]),(e=this.createNavigationForm,(0,i.Z)({url:"/blog/navigation",method:"post",data:e})).then((function(e){t.$message({message:e.message,type:"success"}),t.resetCreateForm(a),t.getNavigation(),t.createNavigationVisible=!1})).catch((function(a){var e=a.data;422===a.code&&(t.createError=e)})).finally((function(){t.createLoading=!1}))},successUpload:function(a,t,e){this.imageUrlPreview=(0,o.UO)()+a.data.path,this.createNavigationForm.image_path=a.data.path},beforeUpload:function(a){this.uploadData.directory="/navigation",this.uploadData.name=a.name},successUploadEdit:function(a,t,e){this.editImageUrlPreview="",this.editImageUrlPreview=(0,o.UO)()+a.data.path,this.updateNavigationForm.image_path=a.data.path},beforeUploadEdit:function(a){this.uploadData.directory="/navigation",this.uploadData.name=a.name},resetCreateForm:function(a){this.$refs[a].resetFields()},getNavigation:function(){var a=this;this.loading=!0;var t;(t={},(0,i.Z)({url:"/blog/navigation",method:"get",data:t})).then((function(t){var e=t.data;a.loading=!1,a.tableData=JSON.parse(JSON.stringify(e.navigation)),a.navigation_options=JSON.parse(JSON.stringify(e.navigation)),a.navigation_options.unshift({id:0,name:"顶级导航"})})).catch((function(t){a.loading=!1,a.tableData=[],a.total=0}))},handleDragStart:function(a,t){},handleDragEnter:function(a,t,e){},handleDragLeave:function(a,t,e){},handleDragOver:function(a,t,e){},handleDragEnd:function(a,t,e,i){},handleDrop:function(a,t,e,i){}}};const d=(0,e(1900).Z)(s,(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"content_container"},[e("el-scrollbar",[e("div",{staticClass:"container",staticStyle:{"padding-top":"0"}},[e("div",{staticClass:"header_container is-sticky-top"},[e("div",{staticClass:"left"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){a.createNavigationVisible=!0}}},[e("i",{staticClass:"el-icon-plus"}),a._v(" 创建导航\n                    ")]),a._v(" "),e("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){a.draggable=!0}}},[e("i",{staticClass:"el-icon-rank"}),a._v(" 调整排序\n                    ")]),a._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:1==a.draggable,expression:"draggable == true"}],attrs:{size:"small",type:"danger"},on:{click:a.saveSortData}},[a._v("保存排序\n                    ")]),a._v(" "),e("el-button",{directives:[{name:"show",rawName:"v-show",value:1==a.draggable,expression:"draggable == true"}],attrs:{size:"small",type:"danger",plain:""},on:{click:function(t){a.draggable=!1}}},[a._v("取消\n                    ")])],1)]),a._v(" "),e("div",{staticClass:"tree-list"},[e("div",{staticClass:"tree-header"},[e("div",{staticClass:"cell title"},[a._v("导航名称")]),a._v(" "),e("div",{staticClass:"cell title"},[a._v("导航地址")]),a._v(" "),e("div",{staticClass:"cell title"},[a._v("状 态")]),a._v(" "),e("div",{staticClass:"cell edit"},[a._v("操作")])]),a._v(" "),e("el-tree",{class:{"is-drag":a.draggable},attrs:{data:a.tableData,"node-key":"id",draggable:a.draggable,"allow-drop":a.allowDrop,"icon-class":"el-icon-arrow-right","default-expand-all":!0,"default-expanded-keys":a.expandedKeys,"expand-on-click-node":!1},on:{"node-drag-start":a.handleDragStart,"node-drag-enter":a.handleDragEnter,"node-drag-leave":a.handleDragLeave,"node-drag-over":a.handleDragOver,"node-drag-end":a.handleDragEnd,"node-drop":a.handleDrop},scopedSlots:a._u([{key:"default",fn:function(t){var i=t.node,r=t.data;return e("span",{staticClass:"custom-tree-node"},[e("span",{staticClass:"cell title",attrs:{title:r.id}},[a._v(a._s(r.name))]),a._v(" "),e("span",{staticClass:"cell title",attrs:{title:r.id}},[a._v(a._s(r.url))]),a._v(" "),e("span",{staticClass:"cell title"},[1==r.published?e("div",[e("el-tag",[a._v("已启用")])],1):0==r.published?e("div",[e("el-tag",{attrs:{type:"danger"}},[a._v("已禁用")])],1):a._e()]),a._v(" "),e("span",{staticClass:"cell edit"},[e("el-button",{attrs:{title:"添加子分类",type:"text"},on:{click:function(t){return a.createChildren(r)}}},[e("i",{staticClass:"el-icon-plus"})]),a._v(" "),e("el-button",{attrs:{title:"编辑",type:"text"},on:{click:function(t){return a.handleEdit(r)}}},[e("i",{staticClass:"el-icon-edit"})]),a._v(" "),e("el-button",{attrs:{title:"删除",type:"text"},on:{click:function(){return a.handleRemove(i,r)}}},[e("i",{staticClass:"el-icon-delete"})])],1)])}}])})],1)])]),a._v(" "),e("el-dialog",{attrs:{"custom-class":"dialog_tc",title:"创建",visible:a.createNavigationVisible,width:"560px","close-on-click-modal":!1},on:{"update:visible":function(t){a.createNavigationVisible=t}}},[e("el-form",{ref:"createForm",attrs:{model:a.createNavigationForm,"label-width":"80px",size:"medium"}},[e("el-form-item",{attrs:{label:"上级导航",prop:"parent_id",error:a.createError.parent_id?a.createError.parent_id[0]:""}},[e("el-cascader",{attrs:{options:a.navigation_options,clearable:"",filterable:"",props:{checkStrictly:!0,label:"name",value:"id",expandTrigger:"click"},placeholder:"请选择上级导航"},scopedSlots:a._u([{key:"default",fn:function(t){var i=t.node,r=t.data;return[e("span",[a._v(a._s(r.name))]),a._v(" "),i.isLeaf?a._e():e("span",[a._v(" ("+a._s(r.children.length)+") ")])]}}]),model:{value:a.createNavigationForm.parent_id,callback:function(t){a.$set(a.createNavigationForm,"parent_id",t)},expression:"createNavigationForm.parent_id"}})],1),a._v(" "),e("el-form-item",{attrs:{prop:"name",label:"导航名称",required:"",error:a.createError.name?a.createError.name[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"请输入导航名称"},model:{value:a.createNavigationForm.name,callback:function(t){a.$set(a.createNavigationForm,"name",t)},expression:"createNavigationForm.name"}})],1),a._v(" "),e("el-form-item",{attrs:{prop:"url",label:"导航网址",error:a.createError.url?a.createError.url[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"例：www.zealov.com"},model:{value:a.createNavigationForm.url,callback:function(t){a.$set(a.createNavigationForm,"url",t)},expression:"createNavigationForm.url"}})],1),a._v(" "),e("el-form-item",{staticClass:"upload_thumb",attrs:{label:"缩略图",prop:"image_path"}},[e("el-upload",{staticClass:"uploadThumbImg",attrs:{headers:a.headers,action:a.action,"show-file-list":!1,"on-success":a.successUpload,"before-upload":a.beforeUpload,data:a.uploadData}},[a.createNavigationForm.image_path?e("img",{staticClass:"thumb",attrs:{src:a.imageUrlPreview}}):e("i",{staticClass:"el-icon-plus"})]),a._v(" "),e("div",{staticClass:"el-upload__tip"},[a._v("\n                    支持JPG/PNG格式，建议尺寸800*450px或16:9\n                    "),e("br"),a._v("图片大小不超过1MB\n                ")])],1),a._v(" "),e("el-form-item",{attrs:{prop:"description",label:"简介",error:a.createError.description?a.createError.description[0]:""}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入简介",maxlength:"500","show-word-limit":"",rows:3},model:{value:a.createNavigationForm.description,callback:function(t){a.$set(a.createNavigationForm,"description",t)},expression:"createNavigationForm.description"}})],1),a._v(" "),e("el-form-item",{attrs:{prop:"published",label:"状态",error:a.createError.published?a.createError.published[0]:""}},[e("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:a.createNavigationForm.published,callback:function(t){a.$set(a.createNavigationForm,"published",t)},expression:"createNavigationForm.published"}})],1)],1),a._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(t){a.createNavigationVisible=!1}}},[a._v("取消")]),a._v(" "),e("el-button",{attrs:{type:"primary",loading:a.createLoading},on:{click:function(t){return a.createNavigation("createForm")}}},[a._v("保存")])],1)],1),a._v(" "),e("el-dialog",{attrs:{"custom-class":"dialog_tc",title:"修改",visible:a.updateNavigationVisible,width:"560px","close-on-click-modal":!1},on:{"update:visible":function(t){a.updateNavigationVisible=t}}},[e("el-form",{ref:"updateForm",attrs:{model:a.updateNavigationForm,"label-width":"80px",size:"medium"}},[e("el-form-item",{attrs:{label:"上级导航",prop:"parent_id",error:a.updateError.parent_id?a.updateError.parent_id[0]:""}},[e("el-cascader",{attrs:{options:a.navigation_options,clearable:"",filterable:"",props:{checkStrictly:!0,label:"name",value:"id",expandTrigger:"click"},placeholder:"请输入上级导航"},scopedSlots:a._u([{key:"default",fn:function(t){var i=t.node,r=t.data;return[e("span",[a._v(a._s(r.name))]),a._v(" "),i.isLeaf?a._e():e("span",[a._v(" ("+a._s(r.children.length)+") ")])]}}]),model:{value:a.updateNavigationForm.parent_id,callback:function(t){a.$set(a.updateNavigationForm,"parent_id",t)},expression:"updateNavigationForm.parent_id"}})],1),a._v(" "),e("el-form-item",{attrs:{prop:"name",label:"导航名称",required:"",error:a.updateError.name?a.updateError.name[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"请输入导航名称"},model:{value:a.updateNavigationForm.name,callback:function(t){a.$set(a.updateNavigationForm,"name",t)},expression:"updateNavigationForm.name"}})],1),a._v(" "),e("el-form-item",{attrs:{prop:"url",label:"导航地址",error:a.updateError.url?a.updateError.url[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"请输入导航地址"},model:{value:a.updateNavigationForm.url,callback:function(t){a.$set(a.updateNavigationForm,"url",t)},expression:"updateNavigationForm.url"}})],1),a._v(" "),e("el-form-item",{staticClass:"upload_thumb",attrs:{label:"缩略图",prop:"image_path"}},[e("el-upload",{staticClass:"uploadThumbImg",attrs:{headers:a.headers,action:a.action,"show-file-list":!1,"on-success":a.successUploadEdit,"before-upload":a.beforeUploadEdit,data:a.uploadData}},[a.updateNavigationForm.image_path?e("img",{staticClass:"thumb",attrs:{src:a.editImageUrlPreview}}):e("i",{staticClass:"el-icon-plus"})]),a._v(" "),e("div",{staticClass:"el-upload__tip"},[a._v("\n                    支持JPG/PNG格式，建议尺寸800*450px或16:9\n                    "),e("br"),a._v("图片大小不超过1MB\n                ")])],1),a._v(" "),e("el-form-item",{attrs:{prop:"description",label:"简介",error:a.updateError.description?a.updateError.description[0]:""}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入简介",maxlength:"500","show-word-limit":"",rows:3},model:{value:a.updateNavigationForm.description,callback:function(t){a.$set(a.updateNavigationForm,"description",t)},expression:"updateNavigationForm.description"}})],1),a._v(" "),e("el-form-item",{attrs:{prop:"target",label:"打开方式",error:a.updateError.target?a.updateError.target[0]:""}},[e("el-radio",{attrs:{label:"_self"},model:{value:a.updateNavigationForm.target,callback:function(t){a.$set(a.updateNavigationForm,"target",t)},expression:"updateNavigationForm.target"}},[a._v("当前窗口")]),a._v(" "),e("el-radio",{attrs:{label:"_blank"},model:{value:a.updateNavigationForm.target,callback:function(t){a.$set(a.updateNavigationForm,"target",t)},expression:"updateNavigationForm.target"}},[a._v("新建窗口")])],1),a._v(" "),e("el-form-item",{attrs:{prop:"published",label:"状态",error:a.updateError.published?a.updateError.published[0]:""}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:a.updateNavigationForm.published,callback:function(t){a.$set(a.updateNavigationForm,"published",t)},expression:"updateNavigationForm.published"}})],1)],1),a._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(t){a.updateNavigationVisible=!1}}},[a._v("取消")]),a._v(" "),e("el-button",{attrs:{type:"primary",loading:a.updateLoading},on:{click:function(t){return a.updateNavigation("updateForm")}}},[a._v("保存")])],1)],1)],1)}),[],!1,null,null,null).exports}}]);