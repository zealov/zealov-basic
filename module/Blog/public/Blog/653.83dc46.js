"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[653],{8663:(e,t,a)=>{a.d(t,{W3:()=>o,Ue:()=>i,mJ:()=>l,$Z:()=>s,Vx:()=>n,ob:()=>c});var r=a(4319);function o(e){return(0,r.Z)({url:"/blog/category",method:"get",data:e})}function i(e){return(0,r.Z)({url:"/blog/category",method:"post",data:e})}function l(e){return(0,r.Z)({url:"/blog/category/updateSort",method:"post",data:e})}function s(e){return(0,r.Z)({url:"/blog/category/"+e,method:"get"})}function n(e,t){return(0,r.Z)({url:"/blog/category/"+e,method:"put",data:t})}function c(e){return(0,r.Z)({url:"/blog/category/"+e,method:"delete"})}},8653:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var r=a(8663),o=a(113),i=a(1203),l=[],s=0;const n={data:function(){return{expandedKeys:[],draggable:!1,allowDrop:function(e,t,a){return e.level===t.level&&(e.parent.id===t.parent.id?"prev"===a||"next"===a:void 0)},headers:{},action:"",uploadData:{},createCategoryVisible:!1,updateCategoryVisible:!1,category_options:[],loading:!1,tableData:[],createLoading:!1,updateLoading:!1,createError:{},updateError:{},imageUrlPreview:"",editImageUrlPreview:"",createCategoryForm:{name:"",label:"",parent_id:[0],image_path:"",description:"",published:!0,sort:0},updateCategoryForm:{id:"",name:"",label:"",parent_id:"",image_path:"",description:"",published:"",sort:""}}},mounted:function(){this.getCategory(),this.setAction(),this.setHeader()},methods:{setHeader:function(){this.headers={Authorization:"Bearer "+(0,o.LP)()}},updateSort:function(e){var t=this;this.diguiData(e);var a=this;new Promise((function(t,r){a.diguiData(e),t()})).then((function(){var e={sortData:l};(0,r.mJ)(e).then((function(e){200==e.code&&t.$message({message:"成功",type:"success"})}))}))},diguiData:function(e){for(var t=0;t<e.length;t++){var a=e[t];l[s]={id:a.id,sort:s},s++,a.children&&this.diguiData(a.children)}},handleRemove:function(e,t){var a=this;"undefined"==t.children||null==t.children?this.$confirm("确定要删除么？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,r.ob)(t.id).then((function(){a.$message({type:"success",message:"删除成功!"}),a.getCategory()})).catch((function(e){var t=e.response.data;200!==t.code&&a.$message({type:"info",message:t.message})}))})).catch((function(){a.$message({type:"info",message:"取消删除"})})):this.$message({type:"warning",message:"该分类下存在子分类，请先删除子分类！！！"})},updateCategory:function(){var e=this;this.updateError={},this.updateLoading=!0;var t=this.updateCategoryForm.parent_id;t instanceof Array&&(this.updateCategoryForm.parent_id=t.slice(-1)[0]),(0,r.Vx)(this.updateCategoryForm.id,this.updateCategoryForm).then((function(t){e.$message({message:t.message,type:"success"}),e.updateCategoryVisible=!1,e.getCategory()})).catch((function(t){var a=t.data;422===t.code&&(e.updateError=a)})).finally((function(){e.updateLoading=!1}))},handleEdit:function(e){var t=this;this.updateError={},(0,r.$Z)(e.id).then((function(e){var a=e.data;t.updateCategoryVisible=!0,t.updateCategoryForm=a;var r;r=t.parentData([],a.parent_id,t.category_options),t.updateCategoryForm.parent_id=0==r.length?[0]:r,t.updateLoading=!1,t.editImageUrlPreview=(0,i.UO)()+a.image_path}))},createChildren:function(e){this.createCategoryVisible=!0;var t;t=this.parentData([],e.id,this.category_options),this.createCategoryForm.parent_id=0==t.length?[0]:t},parentData:function(e,t,a){var r=this;return a.forEach((function(a){t==a.id?0!=t&&(e.unshift(a.id),r.parentData(e,a.parent_id,r.category_options)):a.children instanceof Array&&r.parentData(e,t,a.children)})),e},saveSortData:function(){this.draggable=!1,this.updateSort(this.tableData)},createCategory:function(e){var t=this;this.createLoading=!0,this.createError={};var a=this.createCategoryForm.parent_id;a instanceof Array&&(this.createCategoryForm.parent_id=a.slice(-1)[0]),(0,r.Ue)(this.createCategoryForm).then((function(a){t.$message({message:a.message,type:"success"}),t.resetCreateForm(e),t.getCategory(),t.createCategoryVisible=!1})).catch((function(e){var a=e.data;422===e.code&&(t.createError=a)})).finally((function(){t.createLoading=!1}))},successUpload:function(e,t,a){this.imageUrlPreview=(0,i.UO)()+e.data.path,this.createCategoryForm.image_path=e.data.path},beforeUpload:function(e){this.uploadData.directory="/category",this.uploadData.name=e.name},successUploadEdit:function(e,t,a){this.editImageUrlPreview=(0,i.UO)()+e.data.path,this.updateCategoryForm.image_path=e.data.path},beforeUploadEdit:function(e){this.uploadData.directory="/category",this.uploadData.name=e.name},setAction:function(){this.action=(0,i.Vy)()+"/blog/file/upload"},resetCreateForm:function(e){this.$refs[e].resetFields()},getCategory:function(){var e=this;this.loading=!0;(0,r.W3)({}).then((function(t){var a=t.data;e.loading=!1,e.tableData=JSON.parse(JSON.stringify(a.category)),e.category_options=JSON.parse(JSON.stringify(a.category)),e.category_options.unshift({id:0,name:"顶级分类"})})).catch((function(t){e.loading=!1,e.tableData=[],e.total=0}))},handleDragStart:function(e,t){},handleDragEnter:function(e,t,a){},handleDragLeave:function(e,t,a){},handleDragOver:function(e,t,a){},handleDragEnd:function(e,t,a,r){},handleDrop:function(e,t,a,r){}}};const c=(0,a(1900).Z)(n,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content_container"},[a("el-scrollbar",[a("div",{staticClass:"container",staticStyle:{"padding-top":"0"}},[a("div",{staticClass:"header_container is-sticky-top"},[a("div",{staticClass:"left"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.createCategoryVisible=!0}}},[a("i",{staticClass:"el-icon-plus"}),e._v(" 添加分类\n                    ")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(t){e.draggable=!0}}},[a("i",{staticClass:"el-icon-rank"}),e._v(" 调整排序\n                    ")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.draggable,expression:"draggable == true"}],attrs:{size:"small",type:"danger"},on:{click:e.saveSortData}},[e._v("保存排序\n                    ")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1==e.draggable,expression:"draggable == true"}],attrs:{size:"small",type:"danger",plain:""},on:{click:function(t){e.draggable=!1}}},[e._v("取消\n                    ")])],1)]),e._v(" "),a("div",{staticClass:"tree-list"},[a("div",{staticClass:"tree-header"},[a("div",{staticClass:"cell title"},[e._v("分类名称")]),e._v(" "),a("div",{staticClass:"cell title"},[e._v("标 识")]),e._v(" "),a("div",{staticClass:"cell title"},[e._v("状 态")]),e._v(" "),a("div",{staticClass:"cell edit"},[e._v("操作")])]),e._v(" "),a("el-tree",{class:{"is-drag":e.draggable},attrs:{data:e.tableData,"node-key":"id",draggable:e.draggable,"allow-drop":e.allowDrop,"default-expand-all":!0,"icon-class":"el-icon-arrow-right","default-expanded-keys":e.expandedKeys,"expand-on-click-node":!1},on:{"node-drag-start":e.handleDragStart,"node-drag-enter":e.handleDragEnter,"node-drag-leave":e.handleDragLeave,"node-drag-over":e.handleDragOver,"node-drag-end":e.handleDragEnd,"node-drop":e.handleDrop},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,o=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",{staticClass:"cell title",attrs:{title:o.id}},[e._v(e._s(o.name))]),e._v(" "),a("span",{staticClass:"cell title",attrs:{title:o.id}},[e._v(e._s(o.label))]),e._v(" "),a("span",{staticClass:"cell title"},[1==o.published?a("div",[a("el-tag",[e._v("已启用")])],1):0==o.published?a("div",[a("el-tag",{attrs:{type:"danger"}},[e._v("已禁用")])],1):e._e()]),e._v(" "),a("span",{staticClass:"cell edit"},[a("el-button",{attrs:{title:"添加子分类",type:"text"},on:{click:function(t){return e.createChildren(o)}}},[a("i",{staticClass:"el-icon-plus"})]),e._v(" "),a("el-button",{attrs:{title:"编辑",type:"text"},on:{click:function(t){return e.handleEdit(o)}}},[a("i",{staticClass:"el-icon-edit"})]),e._v(" "),a("el-button",{attrs:{title:"删除",type:"text"},on:{click:function(){return e.handleRemove(r,o)}}},[a("i",{staticClass:"el-icon-delete"})])],1)])}}])})],1)])]),e._v(" "),a("el-dialog",{attrs:{"custom-class":"dialog_tc",title:"添加分类",visible:e.createCategoryVisible,width:"560px","close-on-click-modal":!1},on:{"update:visible":function(t){e.createCategoryVisible=t}}},[a("el-form",{ref:"createForm",attrs:{model:e.createCategoryForm,"label-width":"80px",size:"medium"}},[a("el-form-item",{attrs:{label:"上级分类",prop:"parent_id",error:e.createError.parent_id?e.createError.parent_id[0]:""}},[a("el-cascader",{attrs:{options:e.category_options,clearable:"",filterable:"",props:{checkStrictly:!0,label:"name",value:"id",expandTrigger:"click"},placeholder:"请选择上级分类"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,o=t.data;return[a("span",[e._v(e._s(o.name))]),e._v(" "),r.isLeaf?e._e():a("span",[e._v(" ("+e._s(o.children.length)+") ")])]}}]),model:{value:e.createCategoryForm.parent_id,callback:function(t){e.$set(e.createCategoryForm,"parent_id",t)},expression:"createCategoryForm.parent_id"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"name",label:"分类名称",required:"",error:e.createError.name?e.createError.name[0]:""}},[a("el-input",{attrs:{type:"text",placeholder:"请输入分类名称"},model:{value:e.createCategoryForm.name,callback:function(t){e.$set(e.createCategoryForm,"name",t)},expression:"createCategoryForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"label",label:"分类标识",required:"",error:e.createError.label?e.createError.label[0]:""}},[a("el-input",{attrs:{type:"text",placeholder:"限英文字母,设定后不可修改"},model:{value:e.createCategoryForm.label,callback:function(t){e.$set(e.createCategoryForm,"label",t)},expression:"createCategoryForm.label"}})],1),e._v(" "),a("el-form-item",{staticClass:"upload_thumb",attrs:{label:"缩略图",prop:"image_path"}},[a("el-upload",{staticClass:"uploadThumbImg",attrs:{headers:e.headers,action:e.action,"show-file-list":!1,"on-success":e.successUpload,"before-upload":e.beforeUpload,data:e.uploadData}},[e.createCategoryForm.image_path?a("img",{staticClass:"thumb",attrs:{src:e.imageUrlPreview}}):a("i",{staticClass:"el-icon-plus"})]),e._v(" "),a("div",{staticClass:"el-upload__tip"},[e._v("\n                    支持JPG/PNG格式，建议尺寸800*450px或16:9\n                    "),a("br"),e._v("图片大小不超过1MB\n                ")])],1),e._v(" "),a("el-form-item",{attrs:{prop:"description",label:"简介",error:e.createError.description?e.createError.description[0]:""}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入简介",maxlength:"500","show-word-limit":"",rows:3},model:{value:e.createCategoryForm.description,callback:function(t){e.$set(e.createCategoryForm,"description",t)},expression:"createCategoryForm.description"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"published",label:"状态",error:e.createError.published?e.createError.published[0]:""}},[a("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:e.createCategoryForm.published,callback:function(t){e.$set(e.createCategoryForm,"published",t)},expression:"createCategoryForm.published"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.createCategoryVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.createLoading},on:{click:function(t){return e.createCategory("createForm")}}},[e._v("确定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{"custom-class":"dialog_tc",title:"修改分类",visible:e.updateCategoryVisible,width:"560px","close-on-click-modal":!1},on:{"update:visible":function(t){e.updateCategoryVisible=t}}},[a("el-form",{ref:"updateForm",attrs:{model:e.updateCategoryForm,"label-width":"80px",size:"medium"}},[a("el-form-item",{attrs:{label:"上级分类",prop:"parent_id",error:e.updateError.parent_id?e.updateError.parent_id[0]:""}},[a("el-cascader",{attrs:{options:e.category_options,clearable:"",filterable:"",props:{checkStrictly:!0,label:"name",value:"id",expandTrigger:"click"},placeholder:"请选择上级分类"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,o=t.data;return[a("span",[e._v(e._s(o.name))]),e._v(" "),r.isLeaf?e._e():a("span",[e._v(" ("+e._s(o.children.length)+") ")])]}}]),model:{value:e.updateCategoryForm.parent_id,callback:function(t){e.$set(e.updateCategoryForm,"parent_id",t)},expression:"updateCategoryForm.parent_id"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"name",label:"分类名称",required:"",error:e.updateError.name?e.updateError.name[0]:""}},[a("el-input",{attrs:{type:"text",placeholder:"请输入分类名称"},model:{value:e.updateCategoryForm.name,callback:function(t){e.$set(e.updateCategoryForm,"name",t)},expression:"updateCategoryForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"label",label:"分类标识",required:"",error:e.updateError.label?e.updateError.label[0]:""}},[a("el-input",{attrs:{type:"text",placeholder:"限英文字母,设定后不可修改"},model:{value:e.updateCategoryForm.label,callback:function(t){e.$set(e.updateCategoryForm,"label",t)},expression:"updateCategoryForm.label"}})],1),e._v(" "),a("el-form-item",{staticClass:"upload_thumb",attrs:{label:"缩略图",prop:"image_path"}},[a("el-upload",{staticClass:"uploadThumbImg",attrs:{headers:e.headers,action:e.action,"show-file-list":!1,"on-success":e.successUploadEdit,"before-upload":e.beforeUploadEdit,data:e.uploadData}},[e.updateCategoryForm.image_path?a("img",{staticClass:"thumb",attrs:{src:e.editImageUrlPreview}}):a("i",{staticClass:"el-icon-plus"})]),e._v(" "),a("div",{staticClass:"el-upload__tip"},[e._v("\n                    支持JPG/PNG格式，建议尺寸800*450px或16:9\n                    "),a("br"),e._v("图片大小不超过1MB\n                ")])],1),e._v(" "),a("el-form-item",{attrs:{prop:"description",label:"简介",error:e.updateError.description?e.updateError.description[0]:""}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入简介",maxlength:"500","show-word-limit":"",rows:3},model:{value:e.updateCategoryForm.description,callback:function(t){e.$set(e.updateCategoryForm,"description",t)},expression:"updateCategoryForm.description"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"published",label:"状态",error:e.updateError.published?e.updateError.published[0]:""}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.updateCategoryForm.published,callback:function(t){e.$set(e.updateCategoryForm,"published",t)},expression:"updateCategoryForm.published"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.updateCategoryVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",loading:e.updateLoading},on:{click:function(t){return e.updateCategory("updateForm")}}},[e._v("修改")])],1)],1)],1)}),[],!1,null,null,null).exports}}]);